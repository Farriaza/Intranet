{% extends "base.html" %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body { background: #f4f6f9; }

  .form-panel {
    background: #fff;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    max-width: 700px;
    margin: 30px auto;
  }

  .form-panel h3 {
    color: #0a3de4;
    font-weight: 700;
    margin-bottom: 20px;
  }

  .btn-primary {
    background: #0a3de4;
    border: none;
    font-weight: 600;
  }

  .btn-secondary {
    font-weight: 600;
  }
</style>

<div class="container">
  <div class="form-panel">
    {% if cliente %}
      <h3>Editar Cliente</h3>
    {% else %}
      <h3>Agregar Cliente</h3>
    {% endif %}

    <form method="POST" novalidate>
      {% csrf_token %}

      <!-- Tipo de cliente -->
      <div class="mb-3">
        <label class="form-label" for="id_tipo">Tipo de Cliente</label>
        <select id="id_tipo" name="tipo" class="form-select" onchange="toggleClienteTipo()">
          <option value="natural" {% if cliente.tipo == "natural" %}selected{% endif %}>Persona Natural</option>
          <option value="juridica" {% if cliente.tipo == "juridica" %}selected{% endif %}>Persona Jurídica</option>
        </select>
      </div>

      <!-- Campos Persona Natural -->
      <div id="natural-fields" style="display: none;">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label" for="id_nombre">Nombre</label>
            <input type="text" name="nombre" id="id_nombre" class="form-control" value="{{ cliente.nombre|default_if_none:'' }}">
          </div>
          <div class="col-md-6">
            <label class="form-label" for="id_apellido">Apellido</label>
            <input type="text" name="apellido" id="id_apellido" class="form-control" value="{{ cliente.apellido|default_if_none:'' }}">
          </div>
        </div>
      </div>

      <!-- Campos Persona Jurídica -->
      <div id="juridica-fields" style="display: none;">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label" for="id_razon_social">Razón Social</label>
            <input type="text" name="razon_social" id="id_razon_social" class="form-control" value="{{ cliente.razon_social|default_if_none:'' }}">
          </div>
          <div class="col-md-6">
            <label class="form-label" for="id_rut">RUT / NIT</label>
            <input type="text" name="rut" id="id_rut" class="form-control" value="{{ cliente.rut|default_if_none:'' }}">
          </div>
        </div>
      </div>

      <!-- Campos comunes -->
      <div class="row g-3 mt-3">
        <div class="col-md-6">
          <label class="form-label" for="id_email">Email</label>
          <input type="email" name="email" id="id_email" class="form-control" value="{{ cliente.email|default_if_none:'' }}">
        </div>
        <div class="col-md-6">
          <label class="form-label" for="id_telefono">Teléfono</label>
          <input type="text" name="telefono" id="id_telefono" class="form-control" value="{{ cliente.telefono|default_if_none:'' }}">
        </div>
        <div class="col-12">
          <label class="form-label" for="id_direccion">Dirección</label>
          <input type="text" name="direccion" id="id_direccion" class="form-control" value="{{ cliente.direccion|default_if_none:'' }}">
        </div>
        <div class="col-md-6">
          <label class="form-label" for="id_ciudad">Ciudad</label>
          <input type="text" name="ciudad" id="id_ciudad" class="form-control" value="{{ cliente.ciudad|default_if_none:'' }}">
        </div>
        <div class="col-md-6">
          <label class="form-label" for="id_estado">Estado</label>
          <select name="estado" id="id_estado" class="form-select">
            <option value="Activo" {% if cliente.estado == "Activo" %}selected{% endif %}>Activo</option>
            <option value="Inactivo" {% if cliente.estado == "Inactivo" %}selected{% endif %}>Inactivo</option>
          </select>
        </div>
      </div>

      <div class="mt-4 d-flex justify-content-end gap-2">
        <a href="{% url 'cliente' %}" class="btn btn-secondary">Cancelar</a>
        <button type="submit" class="btn btn-primary">Guardar</button>
      </div>

    </form>
  </div>
</div>

<script>
  function toggleClienteTipo() {
    const tipo = document.getElementById('id_tipo').value;
    document.getElementById('natural-fields').style.display = tipo === 'natural' ? 'block' : 'none';
    document.getElementById('juridica-fields').style.display = tipo === 'juridica' ? 'block' : 'none';
  }
  // Inicializa según el tipo actual del cliente
  document.addEventListener('DOMContentLoaded', toggleClienteTipo);
</script>

{% endblock %}
