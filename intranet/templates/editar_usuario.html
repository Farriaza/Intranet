{% extends "base.html" %}
{% load static %}
{% block title %}Editar usuario{% endblock %}
{% block page_title %}Editar usuario{% endblock %}

{% block content %}

<link rel="stylesheet" href="{% static 'editar_usuario.css' %}">

<div class="container-edit">

  <a href="{% url 'panel_usuarios' %}" class="btn-volver">‚Üê Volver al listado</a>

  <div class="card-edit">

    <!-- HEADER -->
    <div class="card-title">
      <span class="icon">üë§</span>
      Editar usuario: {{ usuario_obj.username }}
    </div>

    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}

      {% if form.non_field_errors %}
      <div class="error-box">
        {{ form.non_field_errors }}
      </div>
      {% endif %}

      <!-- 
           FOTO DE PERFIL
      = -->
     <div class="perfil-foto-box">
    <div class="perfil-foto-wrapper">
      <img id="preview-imagen"
           src="{{ usuario_obj.perfil.imagen.url }}"
           alt="Foto de perfil"
           class="perfil-foto">
    </div>

    <input type="file" name="imagen" id="id_imagen" accept="image/*" class="input-oculto">

    <label for="id_imagen" class="btn-foto">
      <i class="bi bi-camera-fill"></i>
      Cambiar foto
    </label>
</div>

      <!-- 
           GRID PRINCIPAL
      = -->
      <div class="form-grid">

        <!-- 
             FICHA 1 ¬∑ DATOS B√ÅSICOS
        = -->
        <div class="ficha">
          <h4 class="subtitulo">Datos b√°sicos</h4>

          <div class="fila fila-2">
            <div>
              <label>Nombre</label>
              {{ form.first_name }}
            </div>
            <div>
              <label>Apellido</label>
              {{ form.last_name }}
            </div>
          </div>

          <!-- CORREO + ANEXO -->
          <div class="fila fila-2">
            <div>
              <label>Correo electr√≥nico</label>
              {{ form.email }}
            </div>
            <div>
              <label>RUN</label>
              {{ form.run }}
            </div>
          </div>

          <div class="fila fila-2">
            <div class="check-label">
              {{ form.is_active }} Usuario activo
            </div>
          </div>
        </div>

        <!-- FICHA 2 ¬∑ DATOS PERSONALES -->
        <div class="ficha">
          <h4 class="subtitulo">Datos personales</h4>

          <div class="fila fila-2">
            <div>
              <label>Fecha de nacimiento</label>
              {{ form.fecha_nacimiento }}
            </div>
            <div>
              <label>Anexo</label>
              {{ form.telefono }}
            </div>
          </div>

          <hr>

          <!-- CONTACTO PRINCIPAL -->
          <h4 class="subtitulo">Contacto de emergencia</h4>

          <div class="fila fila-3">
            <div>
              <label>Nombre</label>
              {{ form.contacto_nombre }}
            </div>
            <div>
              <label>Tel√©fono</label>
              {{ form.contacto_telefono }}
            </div>
            <div>
              <label>Relaci√≥n</label>
              {{ form.contacto_relacion }}
            </div>
          </div>

          <hr>

          <!-- CONTACTO SECUNDARIO -->
          <h4 class="subtitulo">Contacto de emergencia secundario</h4>

          <div class="fila fila-3">
            <div>
              <label>Nombre</label>
              {{ form.contacto2_nombre }}
            </div>
            <div>
              <label>Tel√©fono</label>
              {{ form.contacto2_telefono }}
            </div>
            <div>
              <label>Relaci√≥n</label>
              {{ form.contacto2_relacion }}
            </div>
          </div>
        </div>

        <!--  FICHA 3 ¬∑ DATOS INSTITUCIONALES-->
        <div class="ficha">
          <h4 class="subtitulo">Datos institucionales</h4>

          <div class="fila fila-3">
            <div>
              <label>Estamento</label>
              {{ form.estamento }}
            </div>
            
            <div>
              <label>Cargo</label>
              {{ form.cargo }}
            </div>
            <br>
            <div>
              <label>Unidad / Fiscal√≠a</label>
              {{ form.unidad_fiscalia }}
            </div>
          </div>
        </div>

      </div>

      <!-- FOOTER-->
      <div class="form-footer">
        <a href="{% url 'panel_usuarios' %}" class="btn-cancelar">Cancelar</a>
        <button type="submit" class="btn-guardar">Guardar cambios</button>
      </div>

    </form>
  </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", function () {
  const input = document.getElementById("id_imagen");
  const preview = document.getElementById("preview-imagen");

  if (!input || !preview) return;

  input.addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      preview.src = e.target.result;
    };
    reader.readAsDataURL(file);
  });
});
</script>
<style>
.input-oculto {
    width: 0.1px;
    height: 0.1px;
    opacity: 0;
    overflow: hidden;
    position: absolute;
    z-index: -1;
}

.btn-foto {
    display: inline-flex;
    align-items: center;
    cursor: pointer;
    /* Tus estilos de dise√±o aqu√≠ (colores, padding, etc.) */
}</style>
{% endblock %}
